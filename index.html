<!doctype html>
<html lang="de">
  <head>
    <link rel="manifest" href="manifest.webmanifest" />
    <meta name="theme-color" content="#0b0c10" />

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Essensplan ‚Äì Einfach</title>
    <style>
      :root {
        --bg: #0b0c10;
        --card: #151823;
        --text: #eaf0ff;
        --muted: #a7b0c6;
        --accent: #6ee7ff;
        --line: #242a3a;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Arial;
        background: linear-gradient(160deg, #0b0c10, #0f1220);
        color: var(--text);
      }
      header {
        padding: 20px 16px 10px;
        max-width: 1100px;
        margin: 0 auto;
      }
      h1 {
        margin: 0 0 6px;
        font-size: 20px;
        letter-spacing: 0.2px;
      }
      p {
        margin: 6px 0 0;
        color: var(--muted);
        line-height: 1.35;
      }
      main {
        max-width: 1100px;
        margin: 0 auto;
        padding: 12px 16px 40px;
        display: grid;
        gap: 14px;
        grid-template-columns: 1fr;
      }
      @media (min-width: 980px) {
        main {
          grid-template-columns: 1.05fr 0.95fr;
        }
      }

      .card {
        background: rgba(21, 24, 35, 0.92);
        border: 1px solid var(--line);
        border-radius: 16px;
        padding: 14px;
        box-shadow: 0 10px 26px rgba(0, 0, 0, 0.25);
      }
      .card h2 {
        margin: 0 0 10px;
        font-size: 16px;
      }
      .row {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }
      .pill {
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--line);
        color: var(--muted);
        font-size: 12px;
      }
      .pill strong {
        color: var(--text);
        font-weight: 600;
      }
      .grid {
        display: grid;
        gap: 10px;
      }
      .meal {
        border: 1px solid var(--line);
        border-radius: 14px;
        padding: 12px;
        background: rgba(10, 12, 18, 0.35);
      }
      .meal h3 {
        margin: 0 0 6px;
        font-size: 14px;
      }
      .meal .time {
        color: var(--accent);
        font-weight: 700;
        margin-right: 8px;
      }
      .meal ul {
        margin: 8px 0 0 18px;
        color: var(--muted);
      }
      .meal li {
        margin: 3px 0;
      }

      label {
        display: block;
        font-size: 12px;
        color: var(--muted);
        margin: 8px 0 6px;
      }
      select,
      input[type='text'] {
        width: 100%;
        padding: 10px 10px;
        border-radius: 12px;
        border: 1px solid var(--line);
        background: rgba(8, 10, 14, 0.6);
        color: var(--text);
        outline: none;
      }
      select:focus,
      input:focus {
        border-color: rgba(110, 231, 255, 0.55);
      }
      button {
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid rgba(110, 231, 255, 0.35);
        background: rgba(110, 231, 255, 0.12);
        color: var(--text);
        cursor: pointer;
        font-weight: 600;
      }
      button:hover {
        background: rgba(110, 231, 255, 0.18);
      }
      .muted {
        color: var(--muted);
      }
      .small {
        font-size: 12px;
      }
      .sep {
        height: 1px;
        background: var(--line);
        margin: 12px 0;
      }
      .recipeBox {
        border: 1px dashed rgba(110, 231, 255, 0.35);
        padding: 12px;
        border-radius: 14px;
        background: rgba(0, 0, 0, 0.12);
      }
      .recipeBox h4 {
        margin: 0 0 8px;
        font-size: 14px;
      }
      .recipeBox ol {
        margin: 8px 0 0 18px;
        color: var(--muted);
      }
      .kpi {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .kpi .pill {
        background: rgba(0, 0, 0, 0.1);
      }
      .footerNote {
        margin-top: 10px;
        color: var(--muted);
        font-size: 12px;
        line-height: 1.35;
      }
      /* Improve readability for recipes */
      .recipeBox {
        font-size: 15px;
        line-height: 1.5;
      }

      .recipeBox {
        font-size: 16px;
      }

      .recipeBox ul,
      .recipeBox ol {
        font-size: 15px;
      }

      .recipeBox .small {
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Essensplan (einfach) ‚Äì f√ºr deinen Freund</h1>
      <p>Fixer Tagesrhythmus + Portionen + ‚ÄûBaukasten‚Äú f√ºr schnelle Rezept-Ideen. Keine Registrierung, l√§uft lokal im Browser.</p>
    </header>

    <main>
      <!-- LEFT: Tagesplan -->
      <section class="card" aria-label="Tagesplan">
        <div class="row" style="justify-content: space-between">
          <h2 style="margin: 0">üïí Tagesplan</h2>
          <span id="nowPill" class="pill">Jetzt: --:--</span>
        </div>

        <div class="kpi" style="margin-top: 10px">
          <span class="pill"><strong>Fr√ºhst√ºck</strong> 07:00</span>
          <span class="pill"><strong>Snack</strong> 10:00</span>
          <span class="pill"><strong>Mittag</strong> 13:00</span>
          <span class="pill"><strong>Snack</strong> 16:00</span>
          <span class="pill"><strong>Abend</strong> 18‚Äì19</span>
        </div>

        <div class="grid" style="margin-top: 12px">
          <div class="meal" id="meal-0700">
            <h3><span class="time">07:00</span> Fr√ºhst√ºck</h3>
            <ul>
              <li>1 Portion <strong>Kohlenhydrate</strong></li>
              <li>1 Portion <strong>Fett</strong></li>
              <li>1 Portion <strong>Protein</strong></li>
              <li>1 Portion <strong>Obst</strong></li>
              <li><em>Optional:</em> 1 Portion <strong>Gem√ºse</strong></li>
            </ul>
          </div>

          <div class="meal" id="meal-1000">
            <h3><span class="time">10:00</span> Snack</h3>
            <ul>
              <li><strong>Max. ~200 kcal</strong></li>
              <li>Fokus: <strong>Protein</strong> (z. B. Skyr, Quark, Shake)</li>
            </ul>
          </div>

          <div class="meal" id="meal-1300">
            <h3><span class="time">13:00</span> Mittagessen</h3>
            <ul>
              <li>1 Portion <strong>Kohlenhydrate</strong></li>
              <li>1 Portion <strong>Gem√ºse</strong></li>
              <li>1 Portion <strong>Fett</strong></li>
              <li>1 Portion <strong>Protein</strong></li>
            </ul>
          </div>

          <div class="meal" id="meal-1600">
            <h3><span class="time">16:00</span> Snack</h3>
            <ul>
              <li><strong>Max. ~200 kcal</strong></li>
              <li>Fokus: <strong>Protein</strong></li>
            </ul>
          </div>

          <div class="meal" id="meal-1830">
            <h3><span class="time">18:00‚Äì19:00</span> Abendessen</h3>
            <ul>
              <li>1 Portion <strong>Protein</strong></li>
              <li>1 Portion <strong>Fett</strong></li>
              <li>1 Portion <strong>Gem√ºse</strong></li>
            </ul>
          </div>
        </div>

        <div class="sep"></div>

        <h2 style="margin: 0 0 8px">üìè Portionen (Beispiele)</h2>
        <p class="muted small">
          Diese Beispiele sind bewusst einfach gehalten. Ihr k√∂nnt die Liste unten jederzeit anpassen (im Code oder sp√§ter mit Speichern/Favoriten).
        </p>

        <div class="grid" style="margin-top: 10px">
          <div class="meal">
            <h3>Protein (1 Portion)</h3>
            <ul>
              <li>H√§hnchen/Pute/Fisch: ca. <strong>120‚Äì180 g</strong> (je nach Plan)</li>
              <li>Magerquark/Skyr: <strong>200‚Äì250 g</strong></li>
              <li>Eier: <strong>2‚Äì3 St√ºck</strong></li>
              <li>Tofu: <strong>150‚Äì200 g</strong></li>
            </ul>
          </div>

          <div class="meal">
            <h3>Kohlenhydrate (1 Portion)</h3>
            <ul>
              <li>Kartoffeln: <strong>200‚Äì300 g</strong> gekocht</li>
              <li>Reis/Nudeln: <strong>60‚Äì80 g</strong> roh (oder ~180‚Äì240 g gekocht)</li>
              <li>Haferflocken: <strong>40‚Äì60 g</strong></li>
              <li>Brot: <strong>1‚Äì2 Scheiben</strong> (je nach Gr√∂√üe)</li>
            </ul>
          </div>

          <div class="meal">
            <h3>Fett (1 Portion)</h3>
            <ul>
              <li>Oliven√∂l: <strong>1 EL</strong></li>
              <li>N√ºsse: <strong>20‚Äì30 g</strong></li>
              <li>Avocado: <strong>¬Ω</strong></li>
              <li>K√§se: <strong>20‚Äì30 g</strong></li>
            </ul>
          </div>

          <div class="meal">
            <h3>Obst & Gem√ºse</h3>
            <ul>
              <li>Gem√ºse: <strong>1‚Äì2 Handvoll</strong> (Brokkoli, Paprika, Salat, ‚Ä¶)</li>
              <li>Obst: <strong>1 St√ºck</strong> (Apfel/Banane) oder <strong>1 Schale</strong> Beeren</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- <label for="mealSel">Mahlzeit</label>
      <select id="mealSel">
        <option value="breakfast">Fr√ºhst√ºck (07:00)</option>
        <option value="snack">Snack (10:00 / 16:00)</option>
        <option value="lunch">Mittagessen (13:00)</option>
        <option value="dinner">Abendessen (18‚Äì19)</option>
      </select>

      <div id="fruitBlock">
        <label for="fruitSel">Obst (nur Fr√ºhst√ºck)</label>
        <select id="fruitSel"></select>
      </div> -->

      <!-- RIGHT: Baukasten + Rezept -->
      <section class="card" aria-label="Rezept-Baukasten">
        <h2>üç≥ Rezept-Baukasten (simpel)</h2>
        <p class="muted">W√§hle Zutaten aus. Die App schl√§gt dir eine einfache Zubereitung vor.</p>

        <label for="mealSel">Mahlzeit</label>
        <select id="mealSel">
          <option value="breakfast">Fr√ºhst√ºck (07:00)</option>
          <option value="snack">Snack (10:00 / 16:00)</option>
          <option value="lunch">Mittagessen (13:00)</option>
          <option value="dinner">Abendessen (18‚Äì19)</option>
        </select>

        <label for="personName">Name (optional)</label>
        <input id="personName" type="text" placeholder="z. B. Max" />

        <div class="sep"></div>

        <div id="fruitBlock">
          <label for="fruitSel">Obst (nur Fr√ºhst√ºck)</label>
          <select id="fruitSel"></select>
        </div>

        <div id="snackBlock" style="display: none">
          <label for="snackSel">Snack-Idee (10:00 / 16:00)</label>
          <select id="snackSel"></select>
          <p class="muted small" style="margin-top: 6px">Ziel: <strong>max. ~100 kcal</strong> ¬∑ einfach ¬∑ plan-konform</p>
        </div>

        <div id="proteinField">
          <label for="proteinSel">Protein</label>
          <select id="proteinSel"></select>
        </div>

        <div id="vegField">
          <label for="vegSel">Gem√ºse</label>
          <select id="vegSel"></select>
        </div>

        <div id="carbField">
          <label for="carbSel">Kohlenhydrate</label>
          <select id="carbSel"></select>
        </div>

        <div id="fatField">
          <label for="fatSel">Fett</label>
          <select id="fatSel"></select>
        </div>

        <div class="row" style="margin-top: 12px">
          <button id="suggestBtn">Rezept vorschlagen</button>
          <button id="randomBtn" title="Zuf√§llige Kombi">Zufall</button>
        </div>

        <div class="sep"></div>

        <div class="recipeBox" id="recipeBox">
          <h4>‚úÖ Vorschlag</h4>
          <p class="muted small" id="recipeIntro">W√§hle oben Zutaten und klicke auf ‚ÄûRezept vorschlagen‚Äú.</p>
          <div id="recipeContent"></div>
        </div>

        <p class="footerNote">
          Tipp: Wenn ihr sp√§ter speichern wollt (Favoriten, Einkaufsliste, ‚ÄûWas habe ich gegessen?‚Äú), kann ich das in 10‚Äì20 Zeilen JavaScript per
          <code>localStorage</code> erg√§nzen.
        </p>
      </section>
    </main>

    <script>
      const DATA = {
        protein: [
          { name: 'H√§hnchenbrust', method: 'Pfanne / Ofen', portion: '1 Handfl√§che (‚âà 150 g)' },
          { name: 'Putenbrust', method: 'Pfanne / Ofen', portion: '1 Handfl√§che (‚âà 150 g)' },
          { name: 'Rind (mager)', method: 'Pfanne', portion: '1 Handfl√§che (‚âà 150 g)' },
          { name: 'Schweinefilet', method: 'Pfanne', portion: '1 Handfl√§che (‚âà 150 g)' },
          { name: 'Lachs', method: 'Pfanne / Ofen', portion: '1 Handfl√§che (‚âà 150 g)' },
          {
            name: 'Thunfisch (Dose, im eigenen Saft)',
            method: 'Kalt / Salat',
            portion: '¬Ω Dose abgetropft (‚âà 80‚Äì100 g)',
          },
          { name: 'Kabeljau / Wei√üfisch', method: 'Pfanne / Ofen', portion: '1 Handfl√§che (‚âà 170 g)' },
          { name: 'Eier', method: 'R√ºhrei / gekocht', portion: '2 St√ºck' },
          { name: 'Eiklar', method: 'Pfanne', portion: '200 ml (‚âà 1 kleines Glas)' },
          { name: 'Tofu', method: 'Pfanne', portion: '¬Ω Block (‚âà 150‚Äì200 g)' },
          { name: 'Tempeh', method: 'Pfanne', portion: '¬Ω Packung (‚âà 100‚Äì150 g)' },
          { name: 'Magerquark', method: 'Kalt', portion: '1 Becher (‚âà 200‚Äì250 g)' },
          { name: 'Skyr', method: 'Kalt', portion: '1 Becher (‚âà 200‚Äì250 g)' },
          { name: 'H√ºttenk√§se', method: 'Kalt', portion: '1 Becher (‚âà 200‚Äì250 g)' },
        ],

        veg: [
          { name: 'Brokkoli', method: 'D√§mpfen / Pfanne', portion: '1 Cup gekocht oder 2 Cups roh' },
          { name: 'Zucchini', method: 'Pfanne', portion: '1 Cup (oder 1 mittelgro√üe)' },
          { name: 'Paprika', method: 'Pfanne / Roh', portion: '1 gro√üe oder 2 kleine' },
          { name: 'Spinat', method: 'Pfanne / Roh', portion: '2 Cups roh oder 1 Cup gekocht' },
          { name: 'Blumenkohl', method: 'D√§mpfen / Ofen', portion: '1 Cup (oder 2 gro√üe Handvoll)' },
          { name: 'Karotten', method: 'Roh / gekocht', portion: '2 mittelgro√üe' },
          { name: 'Gr√ºne Bohnen', method: 'Kochen', portion: '1 Cup gekocht' },
          { name: 'Salatmix', method: 'Kalt', portion: '2 Cups' },
          { name: 'Gurke', method: 'Roh', portion: '¬Ω gro√üe Gurke (oder 1 kleine)' },
          { name: 'Tomaten', method: 'Roh / Pfanne', portion: '2 mittelgro√üe (oder 1 Cup geschnitten)' },
        ],

        carbs: [
          { name: 'Kartoffeln', method: 'Kochen / Ofen', portion: '2‚Äì3 mittelgro√üe (‚âà 1‚Äì2 F√§uste)' },
          { name: 'S√º√ükartoffeln', method: 'Ofen / Pfanne', portion: '1 mittelgro√üe (‚âà 1 Faust)' },
          { name: 'Reis (wei√ü oder braun)', method: 'Kochen', portion: '1 Cup gekocht' },
          { name: 'Quinoa', method: 'Kochen', portion: '1 Cup gekocht' },
          { name: 'Haferflocken', method: 'Warm / Kalt', portion: '¬Ω Cup trocken (‚âà 40‚Äì60 g)' },
          { name: 'Vollkornnudeln', method: 'Kochen', portion: '1 Cup gekocht' },
          { name: 'Vollkornbrot', method: 'Kalt / Toast', portion: '1 Scheibe (gro√ü) oder 2 kleine' },
          { name: 'Amaranth', method: 'Kochen', portion: '1 Cup gekocht' },
          { name: 'Linsen', method: 'Kochen', portion: '1 Cup gekocht' },
          { name: 'Bohnen (schwarz, wei√ü, Kidney)', method: 'Kochen', portion: '1 Cup gekocht (abgetropft)' },
        ],

        fat: [
          { name: 'Oliven√∂l', method: 'Dressing / Pfanne', portion: '1 TL' },
          { name: 'Kokos√∂l', method: 'Pfanne', portion: '1 TL' },
          { name: 'Avocado', method: 'Kalt', portion: '¬º Avocado' },
          { name: 'Mandeln', method: 'Topping', portion: '1 TL (gehackt) ODER 6‚Äì8 St√ºck' },
          { name: 'Waln√ºsse', method: 'Topping', portion: '1 TL (gehackt) ODER 2‚Äì3 halbe' },
          { name: 'Cashews', method: 'Topping', portion: '1 TL (gehackt) ODER 6‚Äì8 St√ºck' },
          { name: 'Erdnussmus', method: 'Topping', portion: '1 TL' },
          { name: 'Mandelmus', method: 'Topping', portion: '1 TL' },
          { name: 'K√§se (z. B. Mozzarella, Feta)', method: 'Kalt / Topping', portion: '1 TL (zerbr√∂selt) ODER 1 kleines St√ºck (‚âà 15 g)' },
          { name: 'Samen (Chia, Leinsamen)', method: 'Topping', portion: '1 TL' },
        ],

        fruit: [
          { name: 'Apfel', portion: '1 klein‚Äìmittel' },
          { name: 'Birne', portion: '1 klein‚Äìmittel' },
          { name: 'Orange', portion: '1 klein‚Äìmittel' },
          { name: 'Beeren', portion: '1 Cup' },
          { name: 'Banane', portion: '¬Ω Banane' },
        ],

        snacks: [
          { name: 'Skyr', portion: '¬Ω Becher (‚âà 120 g)', kcal: 80, note: 'Natur, ohne Extras' },
          { name: 'Magerquark', portion: '¬Ω Becher (‚âà 120 g)', kcal: 85, note: 'Optional Zimt oder S√º√üstoff' },
          { name: 'H√ºttenk√§se', portion: '¬Ω Becher (‚âà 120 g)', kcal: 90, note: 'Sehr gut s√§ttigend' },
          { name: 'Proteinshake', portion: '¬Ω Portion mit Wasser', kcal: 90, note: 'Kein √ñl, keine Milch' },
          { name: 'Ei (gekocht)', portion: '1 St√ºck', kcal: 75, note: 'Super f√ºr unterwegs' },
          { name: 'N√ºsse', portion: '6‚Äì8 Mandeln ODER 1 TL Nussmus', kcal: 100, note: 'Grenzwertig ‚Äì nicht √∂fter als 1√ó t√§glich' },
        ],
      };

      function fillSelect(selectEl, items) {
        selectEl.innerHTML = '';
        items.forEach((it, idx) => {
          const opt = document.createElement('option');
          opt.value = idx;
          opt.textContent = it.name;
          selectEl.appendChild(opt);
        });
      }

      const proteinSel = document.getElementById('proteinSel');
      const vegSel = document.getElementById('vegSel');
      const carbSel = document.getElementById('carbSel');
      const fatSel = document.getElementById('fatSel');
      const mealSel = document.getElementById('mealSel');
      const fruitSel = document.getElementById('fruitSel');
      const fruitBlock = document.getElementById('fruitBlock');

      const proteinField = document.getElementById('proteinField');
      const vegField = document.getElementById('vegField');
      const carbField = document.getElementById('carbField');
      const fatField = document.getElementById('fatField');

      const snackBlock = document.getElementById('snackBlock');
      const snackSel = document.getElementById('snackSel');

      // Auswahl-Merker
      let lastCarbValue = null;

      fillSelect(proteinSel, DATA.protein);
      fillSelect(vegSel, DATA.veg);
      fillSelect(carbSel, DATA.carbs);
      fillSelect(fatSel, DATA.fat);
      fillSelect(fruitSel, DATA.fruit);
      fillSelect(snackSel, DATA.snacks);

      function applyMealRules() {
        const meal = mealSel.value;

        const showFruit = meal === 'breakfast';
        const showCarbs = meal === 'breakfast' || meal === 'lunch';
        const showVeg = meal === 'breakfast' || meal === 'lunch' || meal === 'dinner';
        const showFat = meal === 'breakfast' || meal === 'lunch' || meal === 'dinner';
        const showProtein = meal !== 'snack'; // bei Snack nutzen wir snackBlock
        const showSnack = meal === 'snack';

        // Carbs "merken", wenn sie gleich verschwinden
        if (!showCarbs && carbSel && carbSel.value !== undefined) {
          lastCarbValue = carbSel.value;
        }
        // Wenn Carbs wieder sichtbar werden, vorherige Auswahl zur√ºckholen
        if (showCarbs && lastCarbValue !== null && carbSel) {
          carbSel.value = lastCarbValue;
        }

        fruitBlock.style.display = showFruit ? 'block' : 'none';
        snackBlock.style.display = showSnack ? 'block' : 'none';

        proteinField.style.display = showProtein ? 'block' : 'none';
        vegField.style.display = showVeg ? 'block' : 'none';
        carbField.style.display = showCarbs ? 'block' : 'none';
        fatField.style.display = showFat ? 'block' : 'none';
      }

      mealSel.addEventListener('change', () => {
        applyMealRules();
        if (mealSel.value === 'snack') {
          // Bevorzuge Protein-Snacks
          const proteinSnacks = DATA.snacks.filter((s) => s.kcal <= 90);
          const pool = proteinSnacks.length ? proteinSnacks : DATA.snacks;
          snackSel.value = DATA.snacks.indexOf(pool[Math.floor(Math.random() * pool.length)]);
        }
        renderRecipe();
      });

      applyMealRules();

      function recipeSteps(protein, veg, carb, fat) {
        // super-simple rules
        const steps = [];

        // Protein
        if (protein.method.includes('Pfanne')) {
          steps.push(`${protein.name} w√ºrzen (Salz/Pfeffer/Paprika). In der Pfanne anbraten.`);
        } else if (protein.method.includes('Ofen')) {
          steps.push(`${protein.name} w√ºrzen. Im Ofen garen (z. B. 180‚Äì200¬∞C) bis durch.`);
        } else if (protein.method.includes('gekocht')) {
          steps.push(`${protein.name} kochen (oder als R√ºhrei zubereiten).`);
        } else {
          steps.push(`${protein.name} kalt verwenden (z. B. als Basis/Beilage).`);
        }

        // Gem√ºse
        if (veg.method.includes('D√§mpfen')) {
          steps.push(`${veg.name} d√§mpfen oder kurz kochen, bis es weich ist.`);
        } else if (veg.method.includes('Pfanne')) {
          steps.push(`${veg.name} in der Pfanne kurz anbraten (gern mit etwas Wasser/Deckel, damit es weich wird).`);
        } else if (veg.method.includes('Roh')) {
          steps.push(`${veg.name} waschen/schneiden und roh dazu essen.`);
        } else {
          steps.push(`${veg.name} nach Wahl zubereiten (roh oder gekocht).`);
        }

        // Carbs
        if (carb.name === 'Kartoffeln') {
          steps.push(`Kartoffeln sch√§len (optional) und kochen. Alternativ als Ofenkartoffeln backen.`);
        } else if (carb.method.includes('Kochen')) {
          steps.push(`${carb.name} nach Packungsangabe kochen.`);
        } else {
          steps.push(`${carb.name} als Beilage vorbereiten (z. B. Brot/Haferflocken).`);
        }

        // Fat
        if (fat.name === 'Oliven√∂l') {
          steps.push(`Am Ende 1 EL Oliven√∂l √ºber Gem√ºse/Salat geben oder als Dressing nutzen.`);
        } else if (fat.name === 'Avocado') {
          steps.push(`Avocado dazu (¬Ω St√ºck), z. B. in Scheiben oder als Dip.`);
        } else if (fat.name === 'N√ºsse') {
          steps.push(`N√ºsse abwiegen (20‚Äì30 g) und als Topping nutzen.`);
        } else if (fat.name === 'Erdnussmus') {
          steps.push(`1 EL Erdnussmus als Topping (z. B. in Quark oder auf Brot).`);
        } else {
          steps.push(`${fat.name} in kleiner Menge als Topping/Beilage.`);
        }

        steps.push(`Alles zusammen auf einen Teller ‚Äì fertig. ‚úÖ`);
        return steps;
      }

      function renderRecipe() {
        const name = document.getElementById('personName').value.trim();
        const meal = mealSel.value;

        const p = DATA.protein[Number(proteinSel.value)];
        const v = DATA.veg[Number(vegSel.value)];
        const c = DATA.carbs[Number(carbSel.value)];
        const f = DATA.fat[Number(fatSel.value)];
        const fr = DATA.fruit[Number(fruitSel.value)];

        const intro = document.getElementById('recipeIntro');
        const content = document.getElementById('recipeContent');
        const titleName = name ? `f√ºr ${name}` : 'f√ºr dich';

        if (meal === 'snack') {
          const s = DATA.snacks[Number(snackSel.value)];

          intro.textContent = `Snack ${titleName}: ${s.name}`;

          const warning = s.kcal > 95 ? `<p style="color:#ffb3b3;"><strong>‚ö† Hinweis:</strong> Dieser Snack ist an der 100-kcal-Grenze.</p>` : '';

          content.innerHTML = `
                <p class="small muted"><strong>Portion:</strong> ${s.portion}</p>
                <p class="small muted"><strong>Kalorien:</strong> ca. ${s.kcal} kcal</p>
                ${warning}
                <p class="small muted"><strong>Info:</strong> ${s.note}</p>
                <ol>
                <li>${s.name} vorbereiten.</li>
                <li>Langsam essen ‚Üí S√§ttigung abwarten.</li>
                <li>Wasser oder Tee dazu. ‚úÖ</li>
                </ol>
            `;
          return;
        }

        // Fr√ºhst√ºck: Protein + Carbs + Fat + Fruit (+ optional Gem√ºse)
        if (meal === 'breakfast') {
          intro.textContent = `Fr√ºhst√ºck ${titleName}: ${p.name} + ${c.name} + ${f.name} + ${fr.name}`;
          content.innerHTML = `
      <p class="small muted"><strong>Zutaten & Portionen:</strong></p>
      <ul class="small muted">
        <li><strong>Protein:</strong> ${p.name} ‚Äî ${p.portion}</li>
        <li><strong>Carbs:</strong> ${c.name} ‚Äî ${c.portion}</li>
        <li><strong>Fett:</strong> ${f.name} ‚Äî ${f.portion}</li>
        <li><strong>Obst:</strong> ${fr.name} ‚Äî ${fr.portion}</li>
        <li><em>Optional Gem√ºse:</em> ${v.name} ‚Äî ${v.portion}</li>
      </ul>
      <ol>
        <li>${p.name} zubereiten (${p.method}).</li>
        <li>${c.name} vorbereiten (${c.method}).</li>
        <li>${f.name} als Portion dazu (nicht ‚Äúnach Gef√ºhl‚Äù dr√ºberkippen).</li>
        <li>Obstportion dazu: ${fr.name} (${fr.portion}). ‚úÖ</li>
      </ol>
    `;
          return;
        }

        // Mittag: Protein + Carbs + Fat + Veg
        if (meal === 'lunch') {
          intro.textContent = `Mittagessen ${titleName}: ${p.name} + ${v.name} + ${c.name} + ${f.name}`;
          const steps = recipeSteps(p, v, c, f);
          content.innerHTML = `
      <p class="small muted"><strong>Portionen:</strong></p>
      <ul class="small muted">
        <li><strong>Protein:</strong> ${p.name} ‚Äî ${p.portion}</li>
        <li><strong>Gem√ºse:</strong> ${v.name} ‚Äî ${v.portion}</li>
        <li><strong>Carbs:</strong> ${c.name} ‚Äî ${c.portion}</li>
        <li><strong>Fett:</strong> ${f.name} ‚Äî ${f.portion}</li>
      </ul>
      <ol>${steps.map((s) => `<li>${s}</li>`).join('')}</ol>
    `;
          return;
        }

        // Abend: Protein + Fat + Veg (keine Carbs)
        if (meal === 'dinner') {
          intro.textContent = `Abendessen ${titleName}: ${p.name} + ${v.name} + ${f.name}`;
          content.innerHTML = `
      <p class="small muted"><strong>Portionen:</strong></p>
      <ul class="small muted">
        <li><strong>Protein:</strong> ${p.name} ‚Äî ${p.portion}</li>
        <li><strong>Gem√ºse:</strong> ${v.name} ‚Äî ${v.portion}</li>
        <li><strong>Fett:</strong> ${f.name} ‚Äî ${f.portion}</li>
      </ul>
      <ol>
        <li>${p.name} zubereiten (${p.method}).</li>
        <li>${v.name} zubereiten (${v.method}).</li>
        <li>${f.name} als Portion dazu (${f.portion}). ‚úÖ</li>
      </ol>
    `;
          return;
        }
      }

      document.getElementById('suggestBtn').addEventListener('click', renderRecipe);

      document.getElementById('randomBtn').addEventListener('click', () => {
        proteinSel.value = Math.floor(Math.random() * DATA.protein.length);
        vegSel.value = Math.floor(Math.random() * DATA.veg.length);
        carbSel.value = Math.floor(Math.random() * DATA.carbs.length);
        fatSel.value = Math.floor(Math.random() * DATA.fat.length);
        renderRecipe();
      });

      // "Jetzt" + Highlight der n√§chsten Mahlzeit
      const nowPill = document.getElementById('nowPill');

      const schedule = [
        { id: 'meal-0700', label: '07:00', hour: 7, min: 0 },
        { id: 'meal-1000', label: '10:00', hour: 10, min: 0 },
        { id: 'meal-1300', label: '13:00', hour: 13, min: 0 },
        { id: 'meal-1600', label: '16:00', hour: 16, min: 0 },
        { id: 'meal-1830', label: '18:30', hour: 18, min: 30 },
      ];

      function pad(n) {
        return String(n).padStart(2, '0');
      }

      function updateNow() {
        const d = new Date();
        const hh = pad(d.getHours());
        const mm = pad(d.getMinutes());
        nowPill.textContent = `Jetzt: ${hh}:${mm}`;

        // reset styles
        schedule.forEach((s) => {
          const el = document.getElementById(s.id);
          el.style.borderColor = 'var(--line)';
          el.style.boxShadow = 'none';
        });

        // find next meal
        const nowMinutes = d.getHours() * 60 + d.getMinutes();
        let next = schedule.find((s) => s.hour * 60 + s.min >= nowMinutes);
        if (!next) next = schedule[0]; // next day

        const nextEl = document.getElementById(next.id);
        nextEl.style.borderColor = 'rgba(110,231,255,.55)';
        nextEl.style.boxShadow = '0 0 0 3px rgba(110,231,255,.08)';
      }

      updateNow();
      setInterval(updateNow, 30000);
    </script>
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js');
      }
    </script>
  </body>
</html>
